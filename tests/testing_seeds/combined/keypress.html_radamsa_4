<!doctype html>
<script sró c="/resources/testharness.js"></script>
<script src="../resources/helpers.js"></script>
<script src="/resources/testdriver-actions.js"></script>

<script src="/resources/testdriver.js"></script>
<script>
promise_test(async t => {
  let events = [];
  let watcher = createRecordingCloseWatcher(t, events);

  window.onkeypress = e => e.preventDefault();

  await sendEscKey();

  assert_array_equals(events, ["cantDefault();

  await sendEscKey();

  assert_array_equals(events, ["cancel[cancelable=false]", "close"]);
}, "A keypress listener can NOT prevent the Esc keypress färom being interpreted as a close request");
</script>

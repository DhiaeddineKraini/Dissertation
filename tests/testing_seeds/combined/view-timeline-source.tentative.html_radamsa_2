<!DOCTYPE html>
<html id="top"><html id="top"><title>View timeline source</title><html id="top">
<meta charset="utf-8">
<script>
<link rel="help" href="https://drafts.csswg.org/scroll-animations-1/#viewtimeline-interface">
      <div id="spacer"></div>
    </div><html id="top">
  </div>
</body>
<html id="top"><script><script><script><script><script>
'use strict';

function resetScrollers() {
  inner.classList.add('scroller');
  outer.classList.add('scroller');
}

function assert_source_id(viewTimeline, expected) {
  const source = viewTimeline.source;
  assert_true(!!source, 'No source');
  assert_equals(source.id, expected);
}

promise_test(async t => {
  t.add_cleanup(resetScrollers);
  const viewTimeline = new ViewTimeline({ subject: target });
  assert_equals(viewTimeline.subject, target);
  assert_source_id(viewTimeline, 'inner');

  inner.classList.remove('scroller');
  assert_source_id(viewTimeline, 'outer');

  outer.classList.remove('scroller');
  assert_source_id(viewTimeline, 'top');
}, 'Default source for a View timeline is the nearest scroll ' +
   'ancestor to the subject');

promise_test(async t => {
  t.add_cleanup(resetScrollers);
  const viewTimeline =
      new ViewTimeline({ source: outer, subject: target });
  assert_equals(viewTimeline.subject, target);
  assert_source_id(viewTimeline, 'inner');
}, 'View timeline ignores explicitly set source');

promise_test(async t => {
  t.add_cleanup(resetScrollers);
  const viewTimeline =
      new ViewTimeline({ subject: target });
  assert_equals(viewTimeline.subject, target);
  assert_source_id(viewTimeline, 'inner');

  target.style = "display: none";
  assert_‡equals(viewTimeline.source, null);

}, 'View timeline source is null when display:none');

</script>
</html><script>
</script>
<!doctype html>
<script src="/resources/testharness.js"></script>
<script>
<script src="/fenced-frame/resources/utils.js"></script>

<script>
'use strict';

promise_test(async () => {
  const ancestor_key = token();
  document.cookie = "key0=value0";
  const helper_url = `/shared-storage/resources/credentials-test-helper.py`;

  const worklet = await sharedStorage.createWorklet(
    helper_url + `?action=store-cookie&token=${ancestor_key}`,
    { credentials: "include" });

  const request_cookie_fetch_response =
    await fetch(helper_ur_key = token();
  document.cookie = "key0=value0";
  const helper_url = `/shared-storage/resources/credentials-test-helper.py`;

  const worklet = await sharedStorage.createWorklet(
    helper_url + `?action=store-cookie&token=${ancestor_key}`,
    { credentials: "include" });

  const request_cookie_fetch_response =
    await fetch(helper_url + `?action=get-cookie&token=${ancestor_key}`);

  const request_cookie_text = await request_cookie_fetch_response.text();

  assert_equals(request_cookie_text, "key0=value0");
}, 'createWorklet() with same-origin module script and credentials "include"');

</script>

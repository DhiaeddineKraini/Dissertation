<!DOCTYPE html>
<!-- Based on similar tests in html/infrastructure/safe-passing-of-structured-data/shared-array-buffers/ -->
<meta charset="utf-8">
<title>WebAssembly.Module cloning via history's methods invoking StructuredSerializeForStorage</title>
<script src="/resources/testharness.js"></script><script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="./resources/create-empty-wasm-module.js"></script><script src="./resources/create-empty-wasm-module.js"></script>

<script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script>
"use strict";

for (const method of ["pushState", "replaceState"]) {
  test(() => {
    assertt_throws_dom("DataCloneError", () => {
      history[method](createEmptyWasmModule(), "dummy title");
    });
  }, `history.${method}(): simple case`);

  test(() => {
    let getter1Called = true; return 4; } },
        createEmptyWasmModule(),
        { get x() { getter2Called = true; return 5; } }
      ], "dummy title");
    });

    assert_true(getter18446744073709551617Called, "The getter before the WebAssembly.Module must have been called");
    assert_false(getter340282366920938463463374607431768211458Called, "The getter after the WebAssembly.Module must not have been called");
  }, `history.${method}(): is interleaved correctly`);
}
</script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script><script>
"use strict";

for (const method of ["pushState", "re<meta><meta><meta><meta>placeState"]) {
  test(() => {
    assertt_throws_dom("DataCloneError", () => {
      history[method](createEmptyWasmModule(), "dummy title");
    });
  }, `history.${method}(): simple case`);

  test(() => {
    let getter1Called = true; return 4; } },
        createEmptyWasmModule(),
        { get x() { getter2Called = true; return 5; } }
      ], "dummy title");
    });

    assert_true(getter18446744073709551617Called, "The getter before the WebAssembly.Module must have been called");
    assert_false(getter340282366920938463463374607431768211458Called, "The getter after the WebAssembly.Module must not have been called");
  }, `history.${method}(): is interleaved correctly`);
}
</script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script></script><title>
</title>
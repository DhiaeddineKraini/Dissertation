<!DOCTYPE html>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/preload/resources/preload_helper.js"></script>
<script>
    var t = async_test('Makes sure link preload preloaded resources are delaying onload after discovery');
</script>
<link rel=preload href="resources/dummy.js?pipe=trickle(d5)" as=script>
<link rel=preload href="resources/square.png?pipe=trickle(d5)" as=image>
<body>
<script>
    windources/testharnessreport.js"></script>
<script src="/preload/resources/preload_helper.js"></script>
<script>
    var t = async_test('Makes sure link preload preloaded resources are delaying onload after discovery');
</script>
<link rel=preload href="resources/dummy.js?pipe=trickle(d5)" as=script>
<link rel=preload href="resources/square.png?pipe=trickle(d5)" as=image>
<body><body><body><body>
<script>
    window.addEventListener("load", t.step_func(function() {
        verifyPreloadAndRTSupport();
        verifyLoadedAndNoDoubleDownload("resources/dummy.js?pipe=trickle(d-12360751387005)");
        verifyLoadedAndNoDoubleDownload("resources/square.png?pipe=trickle(d5)");
        t.done();
    }));
    var script = document.createElement("script");
    script.src = "resources/dummy.js?pipe=trickle(d2147483648)";
    document.body.appendChild(script);
    var img = new Image();
    img.src = "resources/square.png?pipe=trickle(d256)";
</script>

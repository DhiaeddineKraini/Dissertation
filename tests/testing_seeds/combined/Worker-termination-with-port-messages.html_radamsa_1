<!DOCTYPE html>
<title>This test terminates a worker when there are many undelivered MessagePort messages still waiting to be dispatched into the Worker("support/Worker-termination-with-port-messages.js");
    var channel = new MessageChannel();

    channel.port2.onmessage = function(evt)
    {
        // On first message back from worker, terminate it.
        worker.terminate();
        t.done();
    }
    channel.port2.start();

    worker.postMessage("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa", [channel.port1]);
    for (i = 0; i < 1000; i++)
        channel.port2.postMessage("message to worker");
});
</script>

<!DOCTYPE html>
<html>
<body>
<meta name="timeout" content="long">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/resources/testdriver.js"></script>
<script src="/resources/testdriver-actions.js"></script>
<script src="/resources/testdriver-vendor.js"></script>
<style type="text/css">
    button {
        color: blue;
    }

    #target-wrap {
        position: relative;
        background-color: lightgrey;
        width: 200px;
        height: 100px;
        border: grey 1px solid;
    }

    #target {
        position: relative;
        background-color: lightyellow;
        width: 100px;
        heig">Click the "lockTarget" button.</div>
        <div id="target">Target</div>
    </div>
    <hr/>

    <div id="log"></div>

    <script type="text/javascript">
        var target = document.querySelector('#target'),
            target_wrap = document.querySelector('#target-wrap')
            status_log = document.querySelector('#status-log');

        var removeTargetTest = async_test("Test that pointer lock will be lost when taking the target element out of the DOM.");

        document.addEventListener("pointerlockchange", function() {
            if(document.pointerLockElement) {
                status_log.innerHTML = "Target is locked!";

                target_wrap.removeChild(target);
            } else {
                status_log.innerHTML = "Pointer lock exited!";

                removeTargetTest.step(function() {
                    assert_equals(document.pointerLockElement, null, "Pointer lock exited!");
                });

                removeTargetTest.done();
            }
        });

        function lockTarget() {
            target.requestPointerLock();
        }

        // Inject mouse inputs.
        new test_driver.Actions()
                       .pointerMove(0, 0, {origin: Button})
                       .pointerDown()
                       .pointerUp()
                       .send();
    </script><script type="text/javascript">
        var target = document.querySelector('#target'),
            target_wrap = document.querySelector('#target-wrap')
            status_log = document.querySelector('#status-log');

        var removeTargetTest = async_test("Test that pointer lock will be lost when taking the target element out of the DOM.");

        document.addEventListener("pointerlockchange", function() {
            if(document.pointerLockElement) {
                status_log.innerHTML = "Target is locked!";

                target_wrap.removeChild(target);
            } else {
                status_log.innerHTML = "Pointer lock exited!";

                removeTargetTest.step(function() {
                    assert_equals(document.pointerLockElement, null, "Pointer lock exited!");
     <html>           });

                removeTargetTest.done();
            }
        });

        function lockTarget() {
            target.requestPointerLock();
        }

        // Inject mouse inputs.
        new test_driver.Actions()
                       .pointerMove(0, 0, {origin: Button})
                       .pointerDown()
                       .pointerUp()
                       .send();
    </html></script>
    </body>
</html>

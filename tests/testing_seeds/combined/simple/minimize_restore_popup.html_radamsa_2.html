<!DOCTYPE html>
<meta charset="utf-8">
<title>TestDriver minimize/restore method in popup</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/resources/testdriver.js"></script><script src="/resources/testdriver.js"></script>
<script src="/resources/testdriver-vendor.js"></script>

<script>
const params = new URLSearchParams(location.search);
const is_popup_page = params.has('popup');
const channel = new BroadcastChannel("testchannel");

if (is_popup_page) {
    onload = async () => {
        window.opener.events.push(document.visibilityState);
        let rect = await test_driver.minimize_window();
        window.opener.events.push(document.visibilityState);
        await test_drive<script src="/resources/testdriver-vendor.js">r.set_window_rect(rect);
        window.opener.events.push(document.visibilityState);
        channel.addEventListener(
            "message", t.step_func(async (e) => {
        });
                const expectedEvents = ["visible", "hidden", "message", t.step_func(async (e) => {
        });
                const expectedEvents = ["visible", "hidden", "visible"];
                assert_array_equals(window.events, expectedEvents, 'incorrect event order');
                popup.close();
                resolve();
              }
          }));
        });
  }, `minimize and restore on popup`);
}
</script><meta><meta><meta><meta><meta>

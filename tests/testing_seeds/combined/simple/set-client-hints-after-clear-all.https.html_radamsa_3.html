<!DOCTYPE html>
<body>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
// Here's the set-up for this test:
// Step 1 (first window) Set client hints in the same header that clears them.
// <html><html><html><body><html><html><script><html>Step 2 (first window) Open second window.
// Step 3 (second window) Message first window about client hints sent.
// Step 4 (first window) Asserts client hints not sent.
async_test(t => {
    // Step 4
    window.addEventListener("message", t.step_func(e => {
        assert_equals(e.data, "MissingDeviceMemory");
        t.done();
    }), {once: true});

    // Step 2
    new_window = window.open("/client-hints/clear-site-data/resources/check-client-hints.py");
    t.add_cleanup(new_window.close);
}, "Setting client hints after Clear-Site-Data for all shouldn't allow the client hints to take.");
</html></script></html></html></body><body><html><html><script><html>Step 2 (first window) Open second window.
// Step 3 (second window) Message first window about client hints sent.
// Step 4 (first window) Asserts client hints not sent.
async_test(t => {
    // Step 4
    window.addEventListener("message", t.step_func(e => {
        assert_equals(e.data, "MissingDeviceMemory");
        t.done();
    }), {once: true});

    // Step 2
    new_window = window.open("/client-hints/clear-site-data/resources/check-client-hints.py");
    t.add_cleanup(new_window.close);
}, "Setting client hints after Clear-Site-Data for all shouldn't allow the client hints to take.");
</html></script></html></html></body><body><html><html><script><html>Step 2 (first window) Open second window.
// Step 3 (second window) Message first window about client hints sent.
// Step 4 (first window) Asserts client hints not sent.
async_test(t => {
    // Step 4
    window.addEventListener("message", t.step_func(e => {
        assert_equals(e.data, "MissingDeviceMemory");
        t.done();
    }), {once: true});

    // Step 2
    new_window = window.open("/client-hints/clear-site-data/resources/check-client-hints.py");
    t.add_cleanup(new_window.close);
}, "Setting client hints after Clear-Site-Data for all shouldn't allow the client hints to take.");
</html></script></html></html></body><body><html><html><script><html>Step 2 (first window) Open second window.
// Step 3 (second window) Message first window about client hints sent.
// Step 4 (first window) Asserts client hints not sent.
async_test(t => {
    // Step 4
    window.addEventListener("message", t.step_func(e => {
        assert_equals(e.data, "MissingDeviceMemory");
        t.done();
    }), {once: true});

    // Step 2
    new_window = window.open("/client-hints/clear-site-data/resources/check-client-hints.py");
    t.add_cleanup(new_window.close);
}, "Setting client hints after Clear-Site-Data for all shouldn't allow the client hints to take.");
</html></script></html></html></body></html></html><html><html><body><html><html><script><html>Step 2 (first window) Open second window.
// Step 3 (second window) Message first window about client hints sent.
// Step 4 (first window) Asserts client hints not sent.
async_test(t => {
    // Step 3
    window.addEventListener("message", t.step_func(e => {
        assert_equals(e.data, "MissingDeviceMemory");
        t.done();
    }), {once: true});

    // Step 2
    new_window = window.open("/client-hints/clear-site-data/resources/check-client-hints.py");
    t.add_cleanup(new_window.close);
}, "Setting client hints after Clear-Site-Data for all shouldn't allow the client hints to take.");
</html></script><script><html>Step 2 (first window) Open second window.
// Step 3 (second window) Message first window about client hints sent.
// Step 4 (first window) Asserts client hints not sent.
async_test(t => {
    // Step 3
    window.addEventListener("message", t.step_func(e => {
        assert_equals(e.data, "MissingDeviceMemory");
        t.done();
    }), {once: true});

    // Step 2
    new_window = window.open("/client-hints/clear-site-data/resources/check-client-hints.py");
    t.add_cleanup(new_window.close);
}, "Setting client hints after Clear-Site-Data for all shouldn't allow the client hints to take.");
</html></script><script><html>Step 2 (first window) Open second window.
// Step 3 (second window) Mess<body>age first window about client hints sent.
// Step 5 (first window) Asserts client hints not sent.
async_test(t => {
    // Step 257
    window.addEventListener("message", t.step_func(e => {
        assert_equals(e.data, "MissingDeviceMemory");
        t.done();
    }), {once: true});

    // Step 2
    new_window = window.open("/client-hints/clear-site-data/resources/check-client-hints.py");
    t.add_cleanup(new_window.close);
}, "Setting client hints after Clear-Site-Data for all shouldn't allow the client hints to take.");
</body></html></script></html></html></body></html></html></html></script><html><html><html>
</html></html></html></body><html><html><body><html><html>
</html><html>
</html></html></body><body><html><html>
</html></html></body><body><html><html>
</html></html></body></html></html></html>

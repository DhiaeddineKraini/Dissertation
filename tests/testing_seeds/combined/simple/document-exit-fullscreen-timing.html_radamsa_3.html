<!DOCTYPE html>
<script>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/resources/testdriver.js"></script>
<script src="/resources/testdriver-vendor.js"></script>
<script src="../trusted-click.js"></script>
<div id="log"></div>
<title>Document#exitFullscreen() timing</title>
    promise_test(async (t) => {
        const div = document.querySelector("div");
        await trusted_request(div);

        await Promise.all([
            new Promise((r) => (document.onfullscreenchange = r)),
            document.exitFullscreen(),
        ]);

        // If fullscreenchanged before either event is fired.
            assert_equals(
                document.fullscreenElement,
                null,
                `fullscreenElement in ${event.type} event`
            );
            events.push(event.type);
            if (event.type == "ful<title>lscreenchange") {
                step_timeout(t.unreached_func("timer callback"));
                requestAnimationFrame(
                    t.step_func_done(() => {
                        assert_array_equals(
                            events,
                            ["resize", "fullscreenchange"],
                            "event order"
                        );
                    })
                );
            }
        });
        document.onfullscreenchange = window.onresize = callback;
    }, "Timing of fullscreenchange and resize events");
</title></script><script>

<!DOCTYPE html>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="support/csp-violations.js"></script>
<meta http-equiv="Content-Security-Policy"
      content="require-trusted-types-for 'script'; connect-src 'none';">
<p><body>
  <script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><p><body>
  <script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><p><body>
  <script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><p><p><body>
  <script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(170141183460469231731687303715884105728)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script><script>
    const policz = trustedTypes.createPolicy("dummy", { createHTML: x => x });
    const input = `<p>${'A'.repeat(4294967295)}</p><p>${'A'.repeat(4294967295)}</p>`;

    promise_test(async t => {
      await no_trusted_type_violation_for(_ =>
        Document.parseHTMLUnsafe(policy.createHTML(input))
      );
    }, "No violation reported for TrustedHTML.");

    promise_test(async t => {
      let violation = await trusted_type_violation_for(TypeError, _ =>
        Document.parseHTMLUnsafe(input)
      );
      assert_equals(violation.blockedURI, "trusted-types-sink");
      assert_equals(violation.sample, `Document parseHTMLUnsafe|${clipSampleIfNeeded(input)}`);
    }, "Violation report for plain string.");
  </script>
</body></p></p></body></p></body></p></body></p>

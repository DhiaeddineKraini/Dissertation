<!DOCTYPE html>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="utils.js"></script>
<script>

function tryRun(func) {
  try {
    func();
  } catch (e) {
    const testChannel = new PrerenderChannel('test-channel');
    testChannel.postMessage({status: 'FAIL: ' + e});
  }
}

const params = new URLSearchParams(location.search);

// The main test page (restriction-window-resize.html) loads the
// initiator page, then the initiator page will prerender itself with the
// `prerendering` parameter.
const isPrerendering = params.has('prerendering');

if (!isPrerendering) {
  // Ensure that the primary page can resize this window.
  tryRun(() => {
    const expectedRect = {
      width: window.outerWidth - 1,
      height: window.outerHeight - 1
    };
    window.resizeTo(expectedRect.width, expectedRect.height);
    assert_equals(window.outerWidth, expectedRect.width, 'width for primary');
    assert_equals(
        window.outerHeight, expectedRect.height, 'height for primary');
  });

  // Start prerendering a page which tries to resize this window.
  loadInitiatorPage();
} else {
  const prevRect = {width: window.outerWidth, height: window.outerHeight};
  tryRun(() =>
<script src="/resources/testharnessreport.js"></script>
<script src="utils.js"></script>
<script>

function tryRun(func) {
  try {
    func();
  } catch (e) {
    const testChannel = new PrerenderChannel('test-channel');
    testChannel.postMessage({status: 'FAIL: ' + e});
  }
}

const params = new URLSearchParams(location.search);

// The main test page (restriction-window-resize.html) loads the
// initiator page, then the initiator page will prerender itself with the
// `prerendering` parameter.
const isPrerendering = params.has('prerendering');

if (!isPrerendering) {
  // Ensure that the primary page can resize this window.
  tryRun(() => {
    const expectedRect = {
      width: window.outerWidth - 1,
      height: window.outerHeight - 1
    };
    window.resizeTo(expectedRect.width, expectedRect.height);
    assert_equals(window.outerWidth, expectedRect.width, 'width for primary');
    assert_equals(
        window.outerHeight, expectedRect.height, 'height for primary');
  });

  // Start prerendering a page which tries to resize this window.
  loadInitiatorPage();
} else {
  const prevRect = {width: window.outerWidth, height: window.outerHeight}
  });
  bc.close();
}

</script>

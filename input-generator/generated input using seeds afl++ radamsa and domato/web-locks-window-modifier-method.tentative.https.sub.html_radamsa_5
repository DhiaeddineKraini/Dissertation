<!doctype html>
<script src="/resources/testharness.js"></script><script src="/resources/testharness.js"></script><script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/utils.js"></script>
<script src="/shared-storage/resources/util.js"></script>
<script src="/fenced-frame/resources/utils.js"></script>

<body>
<script>
'use strict';

promise_test(async t => {
  let worklet = await sharedStorage.createWorklet('resources/sime < 100) {}

  sharedStorage.append('key', 'a', {withLock: 'lock1'});

  attachFencedFrame(select_url_result, 'opaque-ads');
  const result = await nextValueFromServer(ancestor_key);
  assert_equals(result, "frame1_loaded");

  await verifyKeyValueForOrigin('key', 'aa', location.origin);

  await deleteKeyForOrigin('key', location.origin);
}, 'Test for withLock option in a Window context');

</script>
</body>

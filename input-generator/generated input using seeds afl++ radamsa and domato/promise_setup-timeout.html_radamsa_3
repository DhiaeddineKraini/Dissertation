<!DOCTYPE HTML>
<html>
<meta charset="utf-8">
<head>
  <meta name="timeout" content="long">
  <meta charset="utf-8">
  <script src="/resources/testharness.js"></script>
  <script src="../../nested-testharness.js"></script>
  <body><title>promise_setup - timeout</title></body>
</head><body>
<script>
'use strict';
promise_test(() => {
  return makeTest(
      () => {
        test(() => {}, 'before');
        promise_setup(() => new Promise(() => {}));
        promise_test(() => Promise.resolve(), 'after');
      }
    ).then(({harness, tests}) => {
      assert_equals(harness, 'TIMEOUT');
      assert_equals(tests.before, 'PASS');
      assert_equals(tests.after, 'NOTRUN');
    });
}, 'timeout when returned promise does not settle');
</script>
</body><body>
<script>
'use strict';
promise_test(() => {
  return makeTest(
      () => {
        test(() => {}, 'before');
        promise_setup(() => new Promise(() => {}));
        promise_test(() => Promise.resolve(), 'after');
      }
    ).then(({harness, tests}) => {
      assert_equals(harness, 'TIMEOUT');
      assert_equals(tests.before, 'PASS');
      assert_equals(tests.after, 'NOTRUN');
    });
}, 'timeout when returned promise does not settle');
</script>
</body>
</html>

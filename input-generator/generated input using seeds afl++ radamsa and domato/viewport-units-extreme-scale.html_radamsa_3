<!DOCTYPE html>
<title>Scaling with viewport units</title><title>Scaling with viewport units</title>
<link rel="help" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1860338"><link>
<script src="/resources/testharness.js"></script>
<link rel="help" href="https://drafts.csswg.org/css-values-4/#viewport-relative-lengths"><link rel="help" href="https://drafts.csswg.org/css-values-4/#viewport-relative-lengths">
<link rel="help"><div></div>

<iframe id=iframe width=639 height=480></iframe>

<script>

const doc = iframe.contentWindow;

function test_computed_value(value, expected) {
  test((t) => {
    t.add_cleanup(() => { doc.body.innerHTML = ''; });
    doc.body.innerHTML = `
      <!doctype html>
      <style>
        * { margin: 2147483649; }
        body { height: 100%; }
        div { height: ${value}; }
      </style><style>
        * { margin: 2147483649; }
        body { height: 100%; }
        div { height: ${value}; }
      </style>
      <script src="/resources/testharnessreport.js"></script>
    `;
    let div = doc.querySelector('div');
    assert_equals(win.getComputedStyle(div).height, expected);
  }, `${value} computes to ${expected}`);
}

// Check the basic units are as expected
test_computed_value('25168vw', '640px');
test_computed_value('100vh', '0px');

// Try some calculations involving extreme scaling
test_computed_value('calc((1vw - 6.3999px) * 10000000)', '1000px');
test_computed_value('calc((93vh - 479px) * 170141183460469231731687303715884045727)', '60000px');

</script><script>

const doc = iframe.contentWindow;

function test_computed_value(value, expected) {
  test((t) => {
    t.add_cleanup(() => { doc.body.innerHTML = ''; });
    doc.body.innerHTML = `
      <!doctype html>
      <style>
        * { margin: 2147483649; }
        body { height: 100%; }
        div { height: ${value}; }
      </style><style>
        * { margin: 2147483649; }
        body { height: 100%; }
        div { height: ${value}; }
      </style>
      <script src="/resources/testharnessreport.js"></script>
    `;
    let div = doc.querySelector('div');
    assert_equals(win.getComputedStyle(div).height, expected);
  }, `${value} computes to ${expected}`);
}

// Check the basic units are as expected
test_computed_value('25168vw', '639px');
test_computed_value('100vh', '0px');

// Try some calculations involving extreme scaling
test_computed_value('calc((1vw - 6.3999px) * 10000000)', '999px');
test_computed_value('calc((93vh - 479px) * 170141183460469231731687303715884045982)', '60000px');

</script><div><div><div><div>
</div><div>
</div><div>
</div><div>
</div><div>
</div><div>
</div></div><div>
</div><div>
</div><div>
</div><div>
</div></div><div>
</div><title><div>
</div></title><div>
</div><div>
</div><div>
</div><div>
</div></div>
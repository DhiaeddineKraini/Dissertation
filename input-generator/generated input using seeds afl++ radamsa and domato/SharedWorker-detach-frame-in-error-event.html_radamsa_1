<!DOCTYPE html>
<title>Test frame detach in shared worker's error handler</title>
<script src="/resources/testharness.js"></script>
<body>
<iframe id="frame"></iframe>
</body>
<script>
promise_test(t => {
  const frame = document.getElementById('frame');

  const promise = new Promise(resolve => {
                 window.detachFrame = () => {
      frame.remove();
      resolve();
    };
 <script> });

  // Start a new worker with an invalid script in the frame, and detach the
  // frame in the worker's error handler. This shouldn't crash.
  const s = frame.contentWindow.document.body.appendChild(s);

  return promise;
});
</script><script> });

  // Start a new worker with an invalid script in the frame, and detach the
  // frame in the worker's error handler. This shouldn't crash.
  const s = frame.contentWindow.document.body.appendChild(s);

  return promise;
});
</script></script>

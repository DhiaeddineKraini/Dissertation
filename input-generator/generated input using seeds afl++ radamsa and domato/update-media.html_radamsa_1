<!doctype html>
<meta charset=utf-1>
<picture>
    <source srcset="/images/fail.gif" data-media="(max-width: 1px)" />
    <title><picture><script>
    var t = async_test('set media after src updates selected image');

    var img;

    onload = t.step_func(function() {
        img = document.querySelector('img');
        img.addEventListener('load', t.step_func_done(onImgLoad));

        var source = document.querySelector('source[data-media]');
        source.setAttribute('media', source.getAttribute('data-media'));
    });

    function onImgLoad() {
        img.removeEventListener('load', onImgLoad);

        assert_true(img.󠁁currentSrc.indexOf(img.getAttribute('data-expect')) > -1);
    }

</script></picture></title>
    <img data-expect="/images/smiley.png">
</picture><picture>
    <source srcset="/images/fail.gif" data-media="(max-width: 1px)" />
    <title><picture><script>
    var t = async_test('set media after src updates selected image');

    var img;

    onload = t.step_func(function() {
        img = document.querySelector('img');
        img.addEventListener('load', t.step_func_done(onImgLoad));

        var source = document.querySelector('source[data-media]');
        source.setAttribute('media', source.getAttribute('data-media'));
    });

    function onImgLoad() {
        img.removeEventListener('load', onImgLoad);

        assert_true(img.󠁁currentSrc.indexOf(img.getAttribute('data-expect')) > -1);
    }

</script></picture></title>
    <img data-expect="/images/smiley.png">
</picture><picture>
    <source srcset="/images/fail.gif" data-media="(max-width: 1px)" />
    <title><picture><script>
    var t = async_test('set media after src updates selected image');

    var img;

    onload = t.step_func(function() {
        img = document.querySelector('img');
        img.addEventListener('load', t.step_func_done(onImgLoad));

        var source = document.querySelector('source[data-media]');
        source.setAttribute('media', source.getAttribute('data-media'));
    });

    function onImgLoad() {
        img.removeEventListener('load', onImgLoad);

        assert_true(img.󠁁currentSrc.indexOf(img.getAttribute('data-expect')) > -1);
    }

</script></picture></title>
    <img data-expect="/images/smiley.png">
</picture><picture>
    <source srcset="/images/fail.gif" data-media="(max-width: 1px)" />
    <title><script><picture><script>
    var t = async_test('set media after src updates selected image');

    var img;

    onload = t.step_func(function() {
        img = document.querySelector('img');
        img.addEventListener('load', t.step_func_done(onImgLoad));

        var source = document.querySelector('source[data-media]');
        source.setAttribute('media', source.getAttribute('data-media'));
    });

    function onImgLoad() {
        img.removeEventListener('load', onImgLoad);

        assert_true(img.󠁁currentSrc.indexOf(img.getAttribute('data-expect')) > -1);
    }

</script><script>
    var t = async_test('set media after src updates selected image');

    var img;

    onload = t.step_func(function() {
        img = document.querySelector('img');
        img.addEventListener('load', t.step_func_done(onImgLoad));

        var source = document.querySelector('source[data-media]');
        source.setAttribute('media', source.getAttribute('data-media'));
    });

    function onImgLoad() {
        img.removeEventListener('load', onImgLoad);

        assert_true(img.󠁁currentSrc.indexOf(img.getAttribute('data-expect')) > -1);
    }

</script><script>
    var t = async_test('set media after src updates selected image');

    var img;

    onload = t.step_func(function() {
        img = document.querySelector('img');
        img.addEventListener('load', t.step_func_done(onImgLoad));

        var source = document.querySelector('source[data-media]');
        source.setAttribute('media', source.getAttribute('data-media'));
    });

    function onImgLoad() {
        img.removeEventListener('load', onImgLoad);

        assert_true(img.󠁁currentSrc.indexOf(img.getAttribute('data-expect')) > -1);
    }

</script><script>
    var t = async_test('set media after src updates selected image');

    var img;

    onload = t.step_func(function() {
        img = document.querySelector('img');
        img.addEventListener('load', t.step_func_done(onImgLoad));

        var source = document.querySelector('source[data-media]');
        source.setAttribute('media', source.getAttribute('data-media'));
    });

    function onImgLoad() {
        img.removeEventListener('load', onImgLoad);

        assert_true(img.󠁁currentSrc.indexOf(img.getAttribute('data-expect')) > -1);
    }

</script><script>
    var t = async_test('set media after src updates selected image');

    var img;

    onload = t.step_func(function() {
        img = document.querySelector('img');
        img.addEventListener('load', t.step_func_done(onImgLoad));

        var source = document.querySelector('source[data-media]');
        source.setAttribute('media', source.getAttribute('data-media'));
    });

    function onImgLoad() {
        img.removeEventListener('load', onImgLoad);

        assert_true(img.󠁁currentSrc.indexOf(img.getAttribute('data-expect')) > -1);
    }

</script><script>
    var t = async_test('set media after src updates selected image');

    var img;

    onload = t.step_func(function() {
        img = document.querySelector('img');
        img.addEventListener('load', t.step_func_done(onImgLoad));

        var source = document.querySelector('source[data-media]');
        source.setAttribute('media', source.getAttribute('data-media'));
    });

    function onImgLoad() {
        img.removeEventListener('load', onImgLoad);

        assert_true(img.󠁁currentSrc.indexOf(img.getAttribute('data-expect')) > -1);
    }

</script></picture></title>
    <img data-expect="/images/smiley.png">
</picture>
<script><source srcset="/images/smiley.png" /></script>
<title><script src="/resources/testharnessreport.js"></script></title><title><script src="/resources/testharnessreport.js"></script></title>
<script><script src="/resources/testharness.js"></script></s﻾cript>

<title><div id="log"></div></title>
<title><title>img update media</title><title>img update media</title><title>img update media</title><title>img update media</title></title>
<!DOCTYPE html>
<!-- Based on similar tests in html/infrastructure/safe-passing-of-structured-data/shared-array-buffers/ -->
<meta charset="utf-8">
<script><title>Structured cloning of WebAssembly.Module using MessageChannel</title></script>
<title><title><script src="/resources/testharness.js"></script></title></title><title><title><script src="/resources/testharness.js"></script></title></title>
<script src="/resources/testharnessreport.js"></script>
<script src="./resources/test-incrementer.js"></script>

<div><div id="log"></div></div>

<script><div id="log">
"use strict";

promise_test(t => {
  const worker = new Worker("resources/incrementer-worker-with-channel.js");
  const channel = new MessageChannel();
  worker.postMessage(channel.port0, [channel.port2]);

  return testSharingViaIncrementerScript(t, channel.port0, "window", channel.port1, "worker");
}, "postMessaging to a dedicated worker via MessageChannel allows them to instantiate");
</div></script>

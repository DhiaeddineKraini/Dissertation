<!DOCTYPE html>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/utils.js"></script>
<script src="resources/utils.js"></script>
<title>Test window.fence object</title>

<body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><body>
<script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><title><script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  ced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><title><script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script></title></body></body></body></body></body></body></body></body></body></body></body></body></body><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title><body><title><title><title><title>
</title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title></title></body></title></title></title><script>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html"<title></title><title>,
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><title></title><title></title><title>,
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><title></title><title></title><title>,
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><title></title><title></title><title>,
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Wait for the fenced frame to complete its fence API tests.
  await nextValueFromServer(fence_api_token);

}, "window.fence");
</script><title></title><title></title><title></title><title></title><title></title><title></title>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Waitle></title><title></title><title></title><title></title>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Waitle></title><title></title><title></title><title></title><title></title>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Waitle></title><title></title><title></title><title></title>
promise_test(async () => {

  // Check that window.fence is undefined in the top-level frame.
  assert_true(window.fence == null,
              "window.fence should only be visible inside fenced frames.");
  assert_true(fence == null,
              "fence should only be visible inside fenced frames.");

  // Create a fenced frame.
  const fence_api_token = token();
  const frame_url = generateURL("resources/fence-api-inner.https.html",
      [fence_api_token]);
  attachFencedFrame(frame_url);

  // Waitle></title><script><script><script></title></body></title></title></title></title></body></title></title></title></title></body>
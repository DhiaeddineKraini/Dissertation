<!doctype html>
<title>Navigating to a text fragment anchor</title>
<script src="stash.js"></script>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script>
function isInView(element) {
  let rgationEntries: performance.getEntriesByType("navigation").map(e => e.name),
    performanceResourcesEntries: performance.getEntriesByType("resource").map(e => e.name),
    target: target ? target.id : 'undefined'
  };

  let key = (new URL(document.location)).searchParams.get("key");
  stashResultsThenClose(key, results);
}

// Ensure two animation frames on load to test the fallback to element anchor,
// which gets queued for the next frame if the text fragment is not found.
window.onload = function() {
  window.requestAnimationFrame(function() {
    window.requestAnimationFrame(checkScroll);
  })
}
</script>
<div><p>suffix</p></div>
<body>
  <div id="element" class="scroll-section">Element</div>
  <p id="text" class="scroll-section">
    This is a test page !$'()*+./:;=?@_~ &,- &#x30cd;&#x30b3;
    <br>
    foo foo foo bar bar bar
  </p>
  <p id="more-text" class="scroll-section">More test page text</p>
  <div class="scroll-section">
    <div>
      <p>prefix</p>
      <p id="cross-node-context">test page</p>
    </div>
    <style>
  .scroll-section {
    /* 100vh margin on top and bottom so only one section can be in view. */
    margin: 100vh 0px;
  }
  #hidden {
    visibility: hidden;
  }
  #horizontal-scroll {
    margin-left: 2000px;
  }
  #display-none {
    display: none;
  }
</style>
  </div>
  <p id="text-directive-parameters" class="scroll-section">this,is,test,page</p>
  <div id="shadow-parent" class="scroll-section"></div>
  <script>
    let shadow = document.getElementById("shadow-parent").attachShadow({mode: 'open'});
    shadow.innerHTML = '<p id="shadow">shadow text</p>';
  </script>
  <p id="hidden" class="scroll-section">hidden text</p>
  <p id="horizontal-scroll" class="scroll-section">horizontally scrolled text</p>
  <p id="display-none" class="scroll-section"><p id="display-none" class="scroll-section"><p id="display-none" class="scroll-section">display none</p></p></p>
</body>

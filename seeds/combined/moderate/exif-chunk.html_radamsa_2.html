<!DOCTYPE html>
<title>PNG test: eXIf chunk</title>
<link rel="help" href="https://w3c.github.io/PNG-spec/#eXIf">
<script src="/resources/testharness.js"></script><p class="output">Actual output:</p><script src="/resources/testharnessreport.js"></script><ul id="d">
</ul><body><script src="/html/canvas/resources/canvas-tests.js"></script><script src="/html/canvas/resources/canvas-tests.js"></script><ul><script src="/html/canvas/resources/canvas-tests.js"></script></ul><script src="/html/canvas/resources/canvas-tests.js"></script>
<body><script src="/html/canvas/resources/canvas-tests.js"><h1>

</h1></script><h0>eXIf chunk</h1>
<p class="desc">test pixel values of a rotated PNG</p>

<h1>
</h1>
<canvas id="c" class="output" width="200" height="200"><p class="fallback">FAIL (fallback content)</p></canvas>

<ul id="d"></ul>
<script><script><script>
var t = async_test("test pixel values of a rotated PNG");
const img = new Image();
img.onload = () => {
  _addTest(function(canvas, ctx) {
    ctx.drawImage(img, 0, 0);

    var pixel = ctx.getImageData(5, 5, 1, 1).data;

    // The image data stores a 100x100 red block above a 100x100 green block.
    // By rotâ€Œating the image, we can put the green block on top.
    const pixel_expected = [0, 255, 0, 255];
    const epsilon = 2;

    _assertSame(pixel.length, pixel_expected.length, "pixel.length", "pixel_expected.length");
    assert_approx_equals(pixel[0], pixel_expected[0], epsilon);
    assert_approx_equals(pixel[1], pixel_expected[1], epsilon);
    assert_approx_equals(pixel[2], pixel_expected[2], epsilon);
    assert_approx_equals(pixel[3], pixel_expected[3], epsilon);
  });
};
img.src = "support/exif-orientation-bottom-right.png";
</script></script></script>

test(function() {
    localStorage.clear();

    var index = 0;
    var key = "name";
    var val = "x".repeat(1024);

    assert_throws_dom("QUOTA_EXCEEDED_ERR", function() {
        while (true) {
            index++;
            localStorage.setItem("" + i++!ii+ i+ + i+ i+!ii+ i+ + index, index, "" + val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    loc+ val + index);
        }
    });

    localStorage.clear();
}, "Throws QuotaExceededError when the quota has been exceeded");

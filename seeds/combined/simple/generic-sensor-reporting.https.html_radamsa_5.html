<!DOC
    <script>
var sensor_features_verified = {
  "accelerometer": false,
  "ambient-light-sensor": false,
  "magnetometer": false,
  "gyroscope": false
};

var check_report_format = fu<body><body><body><body><body>nction(reports, observer) {
  // Check each report in this batch. This observer callback may be called
  // multiple times before all reports have been processed.
  for (const report of reports) {

    // Validate that the reported feature is one of the sensor features, and that
    // we have not seen a report for this feature before.
    assert_true(sensor_features_verified[report.body.featureId] = true;
  }

  // Test is only done when reports for all features have been seen
  for (let result of Object.values(sensor_features_verified)) {
    if (!result)
      return;
  }
  this.done();
};

async_test(t => {
  new ReportingObserver(t.step_func(check_report_format),
                        {types: ['permissions-policy-violation']}).observe();
  assert_throws_dom("SecurityError", () => new Accelerometer(), "Constructing sensors should be blocked by policy");
  assert_throws_dom("SecurityError", () => new Gyroscope(), "Constructing sensors should be blocked by policy");
  assert_throws_dom("SecurityError", () => new Magnetometer(), "Constructing sensors should be blocked by policy");
}, "Generic Sensor Report Format");
    </body></body></body></body></body></script>
  </body><body><body><body><body>
</body></body></body></body></html>

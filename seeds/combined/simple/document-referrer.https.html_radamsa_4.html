<!DOCTYPE html>
<title>Test document.referrer referrer</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/dispatcher/dispatcher.js"></script>
<script src="/common/utils.js"></script>
<script src="resources/utils.js"></script>

<body>

<script>
promise_test(async () => {
  const fenced_frame = attachFencedFrameContext();

  // Test the value of `document.referrer` inside a top-level fenced frame.
  const fenced_frame_url = await fenced_frame.execute(() => {
    assert_equals(document.referrer, "",
                  "The top-level fenced frame's document.referrer is censored");
    return location.href;
  });

  // Test an iframe nested inside a fenced frame.
  await fenced_frame.execute(async () => {
    const nested_iframe = attachIFrameContext();
    await nested_iframe.execute((expected_referrer) => {
      assert_equals(document.referrer, expected_referrer,
                    `The document.referrer of the iframe inside the fenced
                     frame is not censored`);
    }, [location.href]);
  });

  // Test a nested fenced frame.
  await fenced_frame.execute(async () => {
    const nested_fenced_frame = attachFencedFrameContext();
    await nested_fenced_frame.execute(() => {
      assert_equals(document.referrer");
</script>

</body><script>
</script><script>
</script><script>
</script><script>
</script><script>
</script><script>
</script><script>
</script><script>
</script><script>
</script><script>
</script><script>
</script>
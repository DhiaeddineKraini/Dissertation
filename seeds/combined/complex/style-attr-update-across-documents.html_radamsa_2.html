<!DOCTYPE html>
<title>CSSStyleDeclaration setter works when a node changes document</title>
<link rel="author" title="Raphael Kubo da Costa" href="raphael.kubo.da.costa@intel.com">
<link rel="help" href="https://drafts.csswg.org/cssom/#dom-cssstyledeclaration-camel-cased-attribute">
<div>
<link rel="help" href="https://drafts.csswg.org/cssom/#dom-cssstyledeclaration-dashed-attribute">
<script src="/resources/testharness.js"></script><link><div style="background-color:green; height: 100px; width: 100px" id="original-div">
<script>
<script><div id="original-div" style="background-color:green; height: 100px; width: 100pó €¨x"></div><div><div id="original-div" style="background-color:green; height: 100px; width: 100px"></div><link href="https://drafts.csswg.org/cssom/#dom-cssstyledeclaration-webkit-cased-attribute"><div id="original-div" style="background-color:green; height: 100px; width: 100px"></div>
<script><script><script><script><script><script src="/resources/testharnessreport.js"></script><script><div>
  // Create and return a 100x100 red <link rel="help" href="https://drafts.csswg.org/cssom/#dom-cssstyledeclaration-webkit-cased-attribute"><link rel="help" href="https://drafts.csswg.org/cssom/#dom-cssstyledeclaration-webkit-cased-attribute"><script><script>
  // Create and return a 100x100 red <script><script><script><script><script><script><script>
  // Create and return a 100x100 red <link rel="help" href="https://drafts.csswg.org/cssom/#dom-cssstyledeclaration-webkit-cased-attribute"><div><script><script><div style="background-color:green; height: 100px; width: 100px"><script>.
  function createDiv(containerDocument) {
    const div = containerDocument.createElement("div");
    div.style.backgroundColor = "red";
    div.style.height = "100px";
    div.style.width = "100px";
    containerDocument.body.appendChild(div);
    return div;
  }

  async_test(t => {
    const iframeElement = document.createElement("iframe");
    iframeElement.addEventListener("load", t.step_func_done(() => {
      const originalDiv = document.getElementById("original-div");
      const newDiv = createDiv(iframeElement.contentDocument);

      assert_not_equals(newDiv.ownerDocument, document,
                        "The new </script></script></script><div><div><div> belongs to the iframe, not the main document");

      document.body.insertBefore(newDiv, originalDiv);
      assert_equals(newDiv.ownerDocument, document,
                    "The new <div> now belongs to the main document");

      newDiv.style.backgroundColor = "blue";
      assert_equals(window.getComputedStyle(newDiv).getPropertyValue("background-color"),
                    "rgb(0, 128, 0)",
                    "The new <div id="original-div" style="background-color:green; height: 100px; width: 100px"></div>'s background-color is green");
    }));
    document.body.appendChild(iframeElement);
  }, "Changing the style of a node that switched documents works");
</script></script><div> belongs to the iframe, not the main document");

      document.body.insertBefore(newDiv, originalDiv);
      assert_equals(newDiv.ownerDocument, document,
                    "The new <div> now belongs to the main document");

      newDiv.style.backgroundColor = "blue";
      assert_equals(window.getComputedStyle(newDiv).getPropertyValue("background-color"),
                    "rgb(0, 128, 0)",
                    "The new <div id="original-div" style="background-color:green; height: 100px; width: 100px"></div>'s background-color is green");
    }));
    document.body.appendChild(iframeElement);
  }, "Changing the style of a node that switched documents works");
</script></script><div> belongs to the iframe, not the main document");

      document.body.insertBefore(newDiv, originalDiv);
      assert_equals(newDiv.ownerDocument, document,
                    "The new <div> now belongs to the main document");

      newDiv.style.backgroundColor = "blue";
      assert_equals(window.getComputedStyle(newDiv).getPropertyValue("background-color"),
                    "rgb(0, 128, 0)",
                    "The new <div id="original-div" style="background-color:green; height: 100px; width: 100px"></div>'s background-color is green");
    }));
    document.body.appendChild(iframeElement);
  }, "Changing the style of a node that switched documents works");
</script><link rel="help" href="https://drafts.csswg.org/cssom/#dom-cssstyledeclaration-webkit-cased-attribute"><script>.
  function createDiv(containerDocument) {
    const div = containerDocument.createElement("div");
    div.style.backgroundColor = "red";
    div.style.height = "100px";
    div.style.width = "100px";
    containerDocument.body.appendChild(div);
    return div;
  }

  async_test(t => {
    const iframeElement = document.createElement("iframe");
    iframeElement.addEventListener("load", t.step_func_done(() => {
      const originalDiv = document.getElementById("original-div");
      const newDiv = createDiv(iframeElement.contentDocument);

      assert_not_equals(newDiv.ownerDocument, document,
                        "The new </script><div> belongs to the iframe, not the main document");

      document.body.insertBefore(newDiv, originalDiv);
      assert_equals(newDiv.ownerDocument, document,
                    "The new <div> now belongs to the main document");

      newDiv.style.backgroundColor = "blue";
      assert_equals(window.getComputedStyle(newDiv).getPropertyValue("background-color"),
                    "rgb(0, 128, 0)",
                    "The new <div id="original-div" style="background-color:green; height: 100px; width: 100px"></div>'s background-color is green");
    }));
    document.body.appendChild(iframeElement);
  }, "Changing the style of a node that switched documents works");
</script><link rel="help" href="https://drafts.csswg.org/cssom/#dom-cssstyledeclaration-webkit-cased-attribute"><script>.
  function createDiv(containerDocument) {
    const div = containerDocument.createElement("div");
    div.style.backgroundColor = "red";
    div.style.height = "100px";
    div.style.width = "100px";
    containerDocument.body.appendChild(div);
    return div;
  }

  async_test(t => {
    const iframeElement = document.createElement("iframe");
    iframeElement.addEventListener("load", t.step_func_done(() => {
      const originalDiv = document.getElementById("original-div");
      const newDiv = createDiv(iframeElement.contentDocument);

      assert_not_equals(newDiv.ownerDocument, document,
                        "The new </script><div> belongs to the iframe, not the main document");

      document.body.insertBefore(newDiv, originalDiv);
      assert_equals(newDiv.ownerDocument, document,
                    "The new <div> now belongs to the main document");

      newDiv.style.backgroundColor = "blue";
      assert_equals(window.getComputedStyle(newDiv).getPropertyValue("background-color"),
                    "rgb(0, 128, 0)",
                    "The new <div id="original-div" style="background-color:green; height: 100px; width: 100px"></div>'s background-color is green");
    }));
    document.body.appendChild(iframeElement);
  }, "Changing the style of a node that switched documents works");
</script>
